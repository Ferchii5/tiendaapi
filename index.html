<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
</head>

<body>

    <main>
        <div class="container mt-4">
            <h1>Productos</h1>

            <div class="row" id="charactersList"></div>

            <div class="mt-4">
                <h3>Agregar nuevo producto</h3>
                <form id="newProductForm">
                    <div class="mb-3">
                        <label for="titleInput" class="form-label">Título</label>
                        <input type="text" class="form-control" id="titleInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="descriptionInput" class="form-label">Descripción</label>
                        <textarea class="form-control" id="descriptionInput" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="categoryInput" class="form-label">Categoría</label>
                        <input type="text" class="form-control" id="categoryInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="priceInput" class="form-label">Precio</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="priceInput" required>
                    </div>
                    <div class="mb-3">
                        <label for="imageInput" class="form-label">Imagen</label>
                        <input type="file" class="form-control" id="imageInput" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Agregar</button>
                </form>
            </div>
        </div>
    </main>

    <!-- Modal para editar producto -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">Editar Producto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId">
                        <div class="mb-3">
                            <label for="editTitleInput" class="form-label">Título</label>
                            <input type="text" class="form-control" id="editTitleInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDescriptionInput" class="form-label">Descripción</label>
                            <textarea class="form-control" id="editDescriptionInput" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editCategoryInput" class="form-label">Categoría</label>
                            <input type="text" class="form-control" id="editCategoryInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPriceInput" class="form-label">Precio</label>
                            <input type="number" step="0.01" min="0" class="form-control" id="editPriceInput" required>
                        </div>
                        <div class="mb-3">
                            <label for="editImageInput" class="form-label">Imagen</label>
                            <input type="file" class="form-control" id="editImageInput" accept="image/*">
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar cambios</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
        integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        const url = "https://fakestoreapi.com/products/";

        // Función para crear una nueva tarjeta de producto
        function createProductCard(product) {
            const card = document.createElement('div');
            card.classList.add('col-md-4', 'mb-4');

            const cardContent = `
            <div class="card">
                <img src="${product.image}" class="card-img-top">
                <div class="card-body">
                    <h5 class="card-title"><strong>${product.title}</strong></h5>
                    <p class="card-text"><strong>Descripción:</strong> ${product.description}</p>
                    <p class="card-text"><strong>Categoría:</strong> ${product.category}</p>
                    <p class="card-text precio"><strong>Precio $</strong> ${product.price}</p>
                    <button class="btn btn-primary btn-edit" data-product-id="${product.id}" data-bs-toggle="modal"
                        data-bs-target="#editProductModal">Editar</button>
                    <button class="btn btn-danger btn-delete" data-product-id="${product.id}">Eliminar</button>
                </div>
            </div>
            `;

            card.innerHTML = cardContent;
            return card;
        }

        // Función para agregar un nuevo producto
        function addNewProduct(event) {
            event.preventDefault();

            const title = document.getElementById('titleInput').value;
            const description = document.getElementById('descriptionInput').value;
            const category = document.getElementById('categoryInput').value;
            const price = document.getElementById('priceInput').value;
            const imageFile = document.getElementById('imageInput').files[0];

            const reader = new FileReader();
            reader.onload = function (e) {
                const newProduct = {
                    title: title,
                    description: description,
                    category: category,
                    price: parseFloat(price),
                    image: e.target.result
                };

                const charactersList = document.getElementById('charactersList');
                const newCard = createProductCard(newProduct);
                charactersList.appendChild(newCard);

                // Restablecer los valores del formulario
                document.getElementById('newProductForm').reset();
            };
            reader.readAsDataURL(imageFile);
        }

        // Función para editar un producto
        function editProduct(event) {
            event.preventDefault();

            const productId = document.getElementById('editProductId').value;
            const title = document.getElementById('editTitleInput').value;
            const description = document.getElementById('editDescriptionInput').value;
            const category = document.getElementById('editCategoryInput').value;
            const price = document.getElementById('editPriceInput').value;
            const imageFile = document.getElementById('editImageInput').files[0];

            const reader = new FileReader();
            reader.onload = function (e) {
                const updatedProduct = {
                    title: title,
                    description: description,
                    category: category,
                    price: parseFloat(price),
                    image: e.target.result
                };

                // Actualizar la tarjeta de producto con los cambios
                const productCard = document.querySelector(`.btn-edit[data-product-id="${productId}"]`).closest('.card');
                const productImage = productCard.querySelector('.card-img-top');
                const productTitle = productCard.querySelector('.card-title');
                const productDescription = productCard.querySelector('.card-text:nth-child(2)');
                const productCategory = productCard.querySelector('.card-text:nth-child(3)');
                const productPrice = productCard.querySelector('.card-text.precio');

                productImage.src = updatedProduct.image;
                productTitle.innerHTML = `<strong>${updatedProduct.title}</strong>`;
                productDescription.innerHTML = `<strong>Descripción:</strong> ${updatedProduct.description}`;
                productCategory.innerHTML = `<strong>Categoría:</strong> ${updatedProduct.category}`;
                productPrice.innerHTML = `<strong>Precio $</strong> ${updatedProduct.price}`;

                // Cerrar el modal de edición
                const editProductModal = document.getElementById('editProductModal');
                const bootstrapModal = bootstrap.Modal.getInstance(editProductModal);
                bootstrapModal.hide();
            };
            reader.readAsDataURL(imageFile);
        }

        function deleteProduct(productId) {
            const productCard = document.querySelector(`.btn-delete[data-product-id="${productId}"]`).closest('.col-md-4');
            productCard.remove();
        }

       
        document.getElementById('newProductForm').addEventListener('submit', addNewProduct);

        
        document.getElementById('editProductForm').addEventListener('submit', editProduct);

        
        axios.get(url)
            .then((response) => {
                if (response.status === 200) {
                    const products = response.data;
                    const productsList = document.getElementById('charactersList');

                    products.forEach((product) => {
                        const card = createProductCard(product);
                        productsList.appendChild(card);
                    });

                    // Agregar eventos de clic a los botones de editar y eliminar
                    const editButtons = document.getElementsByClassName('btn-edit');
                    const deleteButtons = document.getElementsByClassName('btn-delete');

                    Array.from(editButtons).forEach((editButton) => {
                        editButton.addEventListener('click', (event) => {
                            const productId = event.target.dataset.productId;
                            const product = products.find((p) => p.id === parseInt(productId));

                            document.getElementById('editProductId').value = productId;
                            document.getElementById('editTitleInput').value = product.title;
                            document.getElementById('editDescriptionInput').value = product.description;
                            document.getElementById('editCategoryInput').value = product.category;
                            document.getElementById('editPriceInput').value = product.price;
                        });
                    });

                    Array.from(deleteButtons).forEach((deleteButton) => {
                        deleteButton.addEventListener('click', (event) => {
                            const productId = event.target.dataset.productId;
                            deleteProduct(productId);
                        });
                    });
                } else {
                    throw new Error("Error al extraer datos" + response.status);
                }
            })
            .catch((error) => {
                console.error("Error: " + error.message);
            });
    </script>

</body>

</html>
